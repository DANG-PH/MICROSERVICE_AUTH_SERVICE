syntax = "proto3";

package auth;

// ===== SERVICE DEFINITION =====
service AuthService {
  // user actions
  rpc Register (RegisterRequest) returns (RegisterResponse) {};
  rpc Login (LoginRequest) returns (LoginResponse) {};
  rpc VerifyOTP (VerifyOtpRequest) returns (VerifyOtpResponse) {};
  rpc Refresh(RefreshRequest) returns (RefreshResponse);

  rpc ChangePassword (ChangePasswordRequest) returns (ChangePasswordResponse) {};
  rpc ResetPassword (ResetPasswordRequest) returns (ResetPasswordResponse) {};
  rpc RequestResetPassword (RequestResetPasswordRequest) returns (RequestResetPasswordResponse) {};
  rpc ChangeEmail (ChangeEmailRequest) returns (ChangeEmailResponse) {};
  rpc ChangeRolePartner (ChangeRolePartnerRequest) returns (ChangeRolePartnerResponse) {};
  rpc GetEmailUser (GetEmailUserRequest) returns (GetEmailUserResponse) {};
  rpc GetProfile (GetProfileRequest) returns (GetProfileReponse) {};
  rpc ChangeAvatar (ChangeAvatarRequest) returns (ChangeAvatarResponse) {};

  // admin actions
  rpc ChangeRole (ChangeRoleRequest) returns (ChangeRoleResponse) {};
  rpc BanUser (BanUserRequest) returns (BanUserResponse) {};
  rpc UnbanUser (UnbanUserRequest) returns (UnbanUserResponse) {};
  rpc SendEmailToUser(SendEmailToUserRequest) returns (SendemailToUserResponse) {};

  // admin service gọi khi check account có đủ điều kiện đăng bán không
  rpc CheckAccount (LoginRequest) returns (LoginResponse) {};

  // WebSocket

  // Gửi lời mời kết bạn ( Người gửi )
  rpc AddFriend(AddFriendRequest) returns (AddFriendResponse) {};

  // Xem tất cả lời mời kết bạn mà bản thân đã gửi ( Người gửi )
  rpc GetSentFriend(GetSentFriendRequest) returns (GetSentFriendResponse) {};

  // Xem tất cả lời mời kết bạn của bản thân để accept ( Người nhận )
  rpc GetIncomingFriend(GetIncomingFriendRequest) returns (GetIncomingFriendResponse) {};

  // Chấp nhận yêu cầu kết bạn ( Người nhận )
  rpc AcceptFriend(AcceptFriendRequest) returns (AcceptFriendResponse) {};

  // Hủy yêu cầu kết bạn ( chỉ áp dụng khi pending ) ( xóa record ) ( Người nhận )
  rpc RejectFriend(RejectFriendRequest) returns (RejectFriendResponse) {};

  // Lấy danh sách bạn bè của bản thân
  rpc GetAllFriend(GetAllFriendRequest) returns (GetAllFriendResponse) {};

  // Xóa 1 bạn bè nhất định ( xóa record )
  rpc Unfriend(UnfriendRequest) returns (UnfriendResponse) {};

  // Chặn bạn bè bất kì ( Blocking User )
  rpc BlockUser(BlockUserRequest) returns (BlockUserResponse) {};
}

// ===== MESSAGES =====

// --- Register/Login/OTP/Refresh  ---
message RegisterRequest {
  string username = 1;
  string password = 2;
  string email = 3;
  string realname = 4;
}

message RegisterResponse {
  bool success = 1;
  int32 auth_id = 2;
}

message LoginRequest {
  string username = 1;
  string password = 2;
}

message LoginResponse {
  string sessionId = 1;
}

message VerifyOtpRequest {
  string sessionId = 1;
  string otp = 2;
}

message VerifyOtpResponse {
  string access_token = 1;
  string refresh_token = 2;
  int32 auth_id = 3;
  string role = 4;
}

message RefreshRequest {
  string refreshToken = 1;
}

message RefreshResponse {
  string access_token = 1;
  string refresh_token = 2;
}

// --- User methods ---
message ChangePasswordRequest {
  string sessionId = 1;
  string oldPassword = 2;
  string newPassword = 3;
}

message ChangePasswordResponse {
  bool success = 1;
}

message ResetPasswordRequest {
  string username = 1;
  string otp = 2;
  string newPassword = 3;
}

message ResetPasswordResponse {
  bool success = 1;
}

message ChangeEmailRequest {
  string sessionId = 1;
  string newEmail = 2;
}

message ChangeEmailResponse {
  bool success = 1;
}

// --- Admin methods ---
message ChangeRoleRequest {
  string username = 1; // user target
  string newRole = 2;
}

message ChangeRoleResponse {
  bool success = 1;
}

message BanUserRequest {
  string username = 1;
}

message BanUserResponse {
  bool success = 1;
}

message UnbanUserRequest {
  string username = 1;
}

message UnbanUserResponse {
  bool success = 1;
}

// --- Request OTP reset password ---
message RequestResetPasswordRequest {
  string username = 1;
}

message RequestResetPasswordResponse {
  bool success = 1;
}

message ChangeRolePartnerRequest {
  string username = 1;
}

message ChangeRolePartnerResponse {
  bool success = 1;
}

message GetEmailUserRequest {
  int32 id = 1;
}

message GetEmailUserResponse {
  string email = 1;
}

message GetProfileRequest {
  int32 id = 1;
}

message GetProfileReponse {
  string role = 1;
  bool biBan = 2;
  string avatarUrl = 3;
}

message SendEmailToUserRequest {
  string who = 1;
  string title = 2;
  string content = 3;
}

message SendemailToUserResponse {
  bool success = 1;
}

message ChangeAvatarRequest {
  int32 userId = 1;
  string avatarUrl = 2;
}

message ChangeAvatarResponse {
  bool success = 1;
}

// Để dành cho tính năng Chat WebSocket

enum FriendStatus {
  PENDING = 0;
  ACCEPTED = 1;
  BLOCKED = 2;
}

message RelationFriendInfo {
  int32 relationId = 1;
  int32 friendId = 2;
  string friendRealname = 3;
  string avatarUrl = 4;
  FriendStatus status = 5;
  string create_at = 6;
}

message FriendInfo {
  int32 friendId = 1;
  string friendRealname = 2;
  string avatarUrl = 3;
  FriendStatus status = 4;
}

message AddFriendRequest {
  int32 userId = 1;
  int32 friendId = 2;
}

message AddFriendResponse {
  int32 relationId = 1;
  int32 userId = 2;
  int32 friendId = 3;
  FriendStatus status = 4;
  string create_at = 5;
}

message GetSentFriendRequest {
  int32 userId = 1;
}

message GetSentFriendResponse {
  repeated RelationFriendInfo relationFriendInfo = 1;
}

message GetIncomingFriendRequest {
  int32 userId = 1;
}

message GetIncomingFriendResponse {
  repeated RelationFriendInfo relationFriendInfo = 1;
}

message AcceptFriendRequest {
  int32 relationId = 1;
}

message AcceptFriendResponse {
  RelationFriendInfo relationFriendInfo = 1;
}

message RejectFriendRequest {
  int32 relationId = 1;
}

message RejectFriendResponse {
  bool success = 1;
}

message GetAllFriendRequest {
  int32 userId = 1;
}

message GetAllFriendResponse {
  repeated FriendInfo friendInfo = 1;
}

message UnfriendRequest {
  int32 userId = 1;
  int32 friendId = 2;
}

message UnfriendResponse {
  bool success = 1;
}

message BlockUserRequest {
  int32 userId = 1;
  int32 friendId = 2;
}

message BlockUserResponse {
  bool success = 1;
}